<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.1 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Experiment 06 - .NET Experiments</title>
<meta name="description" content="The first post in the domain specific language series explores the basics of domain modeling using record types in F#.">


  <meta name="author" content="Daniel Felps">
  
  <meta property="article:author" content="Daniel Felps">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content=".NET Experiments">
<meta property="og:title" content="Experiment 06">
<meta property="og:url" content="https://dlfelps.github.io/2022/10/01/DSL1.html">


  <meta property="og:description" content="The first post in the domain specific language series explores the basics of domain modeling using record types in F#.">







  <meta property="article:published_time" content="2022-10-01T00:00:00+00:00">






<link rel="canonical" href="https://dlfelps.github.io/2022/10/01/DSL1.html">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title=".NET Experiments Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          .NET Experiments
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/"
                
                
              >Quick-Start Guide</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Experiment 06">
    <meta itemprop="description" content="The first post in the domain specific language series explores the basics of domain modeling using record types in F#.">
    <meta itemprop="datePublished" content="2022-10-01T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://dlfelps.github.io/2022/10/01/DSL1.html" itemprop="url">Experiment 06
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-10-01T00:00:00+00:00">October 1, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#study-domain">Study domain</a></li><li><a href="#data-model-1-record-type">Data model #1 (Record type)</a></li><li><a href="#trade-module">Trade Module</a></li><li><a href="#next">Next</a><ul><li><a href="#footnotes">Footnotes</a></li></ul></li></ul></li></ul>
            </nav>
          </aside>
        
        <p>The first post in the <strong>domain specific language</strong> series explores the basics of domain modeling using record types in F#.</p>

<h2 id="introduction">Introduction</h2>

<p>A recent study<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> found that programmers who used functional, statically-typed languages often started a programming task by constructing types to model their problem domain.  I do too, but it’s how I start any complex task (even non-programming tasks). The ability to easily create types is partially what drew me to F# in the first place. I use static types as a lightweight specification language; I can designate high level functions with their anticipated signatures (using types that make sense within the domain) and then the compiler tells me when I stray from that specification as I implement.</p>

<p><img src="/assets/images/hedberg.jpg" alt="Mitch Hedberg" title="Mitch Hedberg" /></p>

<h2 id="study-domain">Study domain</h2>

<p>To motivate this series of posts I chose a similar domain to that used in the book <a href="https://www.manning.com/books/dsls-in-action">DSLs in Action</a>. But since I don’t have a book’s worth of content I will only adopt a subset of this domain to demonstrate my examples. We will model a simplified stock transaction.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center"><strong>Simple transaction</strong></th>
      <th style="text-align: center"><strong>type</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Buy/Sell</td>
      <td style="text-align: center">discriminated union</td>
    </tr>
    <tr>
      <td style="text-align: center">Which stock?</td>
      <td style="text-align: center">discriminated union</td>
    </tr>
    <tr>
      <td style="text-align: center">Price?</td>
      <td style="text-align: center">decimal</td>
    </tr>
    <tr>
      <td style="text-align: center">How many?</td>
      <td style="text-align: center">int</td>
    </tr>
    <tr>
      <td style="text-align: center">Partial/AllOrNone</td>
      <td style="text-align: center">bool</td>
    </tr>
  </tbody>
</table>

<h2 id="data-model-1-record-type">Data model #1 (Record type)</h2>

<p>We start by modeling the domain with an F# Record type. Let me say for the <em>record</em> that I use F# record types 98% of the time. I rarely have a good reason to use anything else. Here is one way to create the record type.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">Transaction</span> <span class="p">=</span> <span class="nc">Buy</span> <span class="p">|</span> <span class="nc">Sell</span>

<span class="k">type</span> <span class="nc">Stocks</span> <span class="p">=</span> <span class="nc">MSFT</span> <span class="p">|</span> <span class="nc">GOOGL</span> <span class="p">|</span> <span class="nc">META</span>

<span class="k">type</span> <span class="nc">Trade</span> <span class="p">=</span> <span class="p">{</span>
        <span class="n">buyOrSell</span><span class="p">:</span> <span class="nc">Transaction</span>
        <span class="n">ticker</span><span class="p">:</span> <span class="nc">Stocks</span>
        <span class="n">numShares</span><span class="p">:</span> <span class="kt">int</span>
        <span class="n">price</span><span class="p">:</span> <span class="n">decimal</span>
        <span class="n">allOrNone</span><span class="p">:</span> <span class="kt">bool</span> <span class="p">}</span></code></pre></figure>

<p>And this is what a list of trades would look like:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="p">(</span><span class="n">trades</span><span class="p">:</span> <span class="nc">Trade</span> <span class="kt">list</span><span class="p">)</span> <span class="p">=</span> 
  <span class="p">[</span>
    <span class="p">{</span><span class="n">buyOrSell</span> <span class="p">=</span> <span class="nc">Buy</span><span class="p">;</span> <span class="n">ticker</span> <span class="p">=</span> <span class="nc">MSFT</span><span class="p">;</span> <span class="n">numShares</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">price</span> <span class="p">=</span> <span class="mi">258</span><span class="p">.</span><span class="mi">32</span><span class="n">m</span><span class="p">;</span> <span class="n">allOrNone</span><span class="p">=</span><span class="bp">true</span><span class="o">};</span>
    <span class="p">{</span><span class="n">buyOrSell</span> <span class="p">=</span> <span class="nc">Sell</span><span class="p">;</span> <span class="n">ticker</span> <span class="p">=</span> <span class="nc">META</span><span class="p">;</span> <span class="n">numShares</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">price</span> <span class="p">=</span> <span class="mi">158</span><span class="p">.</span><span class="mi">71</span><span class="n">m</span><span class="p">;</span> <span class="n">allOrNone</span><span class="p">=</span><span class="bp">true</span><span class="o">};</span>
    <span class="p">{</span><span class="n">buyOrSell</span> <span class="p">=</span> <span class="nc">Sell</span><span class="p">;</span> <span class="n">ticker</span> <span class="p">=</span> <span class="nc">GOOGL</span><span class="p">;</span> <span class="n">numShares</span> <span class="p">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">price</span> <span class="p">=</span> <span class="mi">106</span><span class="p">.</span><span class="mi">08</span><span class="n">m</span><span class="p">;</span> <span class="n">allOrNone</span><span class="p">=</span><span class="bp">true</span><span class="o">};</span>    
  <span class="p">]</span></code></pre></figure>

<h2 id="trade-module">Trade Module</h2>

<p>We will use the following functions throughout the remainder of this series. The last function <code class="language-plaintext highlighter-rouge">tradeMany</code> will be used to process an order (i.e. a list of Trades).</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">module</span> <span class="nc">Trade</span> <span class="p">=</span> 

  <span class="k">let</span> <span class="n">buyOne</span> <span class="n">order</span> <span class="p">=</span> 
    <span class="k">let</span> <span class="n">totalPrice</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">price</span> <span class="p">*</span> <span class="n">decimal</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="n">numShares</span><span class="p">)</span>
    <span class="n">printfn</span> <span class="o">$</span><span class="s2">"You just purchased {order.numShares} shares of {order.ticker} for a total cost of ${totalPrice:N2}."</span> 
    <span class="o">(-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">m</span> <span class="p">*</span> <span class="n">totalPrice</span><span class="p">)</span>

  <span class="k">let</span> <span class="n">sellOne</span> <span class="n">order</span> <span class="p">=</span> 
    <span class="k">let</span> <span class="n">totalPrice</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">price</span> <span class="p">*</span> <span class="n">decimal</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="n">numShares</span><span class="p">)</span>
    <span class="n">printfn</span> <span class="o">$</span><span class="s2">"You just sold {order.numShares} shares of {order.ticker} for a total earnings of ${totalPrice:N2}."</span> 
    <span class="n">totalPrice</span>

  <span class="k">let</span> <span class="n">tradeOne</span> <span class="n">order</span> <span class="p">=</span>   
    <span class="k">match</span> <span class="n">order</span><span class="p">.</span><span class="n">buyOrSell</span> <span class="k">with</span>
    <span class="p">|</span> <span class="nc">Buy</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">buyOne</span> <span class="n">order</span><span class="p">)</span>          
    <span class="p">|</span> <span class="nc">Sell</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">sellOne</span> <span class="n">order</span><span class="p">)</span>

  <span class="k">let</span> <span class="n">tradeMany</span> <span class="n">order</span> <span class="p">=</span> 
    <span class="k">let</span> <span class="n">totalOrderPrice</span> <span class="p">=</span> 
      <span class="n">order</span>
      <span class="p">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">tradeOne</span>
      <span class="p">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">sum</span>
    <span class="n">printfn</span> <span class="o">$</span><span class="s2">"-------------------------------------------------------------------"</span>
    <span class="k">match</span> <span class="p">(</span><span class="n">totalOrderPrice</span> <span class="p">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">m</span><span class="p">)</span> <span class="k">with</span>
    <span class="p">|</span> <span class="bp">true</span> <span class="p">-&gt;</span> <span class="n">printfn</span> <span class="o">$</span><span class="s2">"You just executed a series of trades that earned you ${totalOrderPrice:N2}."</span>
    <span class="p">|</span> <span class="bp">false</span> <span class="p">-&gt;</span> <span class="n">printfn</span> <span class="o">$</span><span class="s2">"You just executed a series of trades that cost you ${totalOrderPrice:N2}."</span></code></pre></figure>

<p>And this is the output if you run <code class="language-plaintext highlighter-rouge">Trade.tradeMany trades</code>:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">You just purchased 4 shares of MSFT for a total cost of $</span>1,033.28.
<span class="gp">You just sold 3 shares of META for a total earnings of $</span>476.13.
<span class="gp">You just sold 6 shares of GOOGL for a total earnings of $</span>636.48.
<span class="go">-------------------------------------------------------------------
</span><span class="gp">You just executed a series of trades that earned you $</span>79.33.</code></pre></figure>

<p>The code listing for this series can be found <a href="https://github.com/dlfelps/dsl-examples">here</a>.</p>

<h2 id="next">Next</h2>

<p>In the next post we will see how to use F# <a href="https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/computation-expressions">computation expressions</a> to create identical <code class="language-plaintext highlighter-rouge">Trade</code> records.</p>

<h4 id="footnotes">Footnotes</h4>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Justin Lubin. 2021. How Statically-Typed Functional Programmers Author Code. In Extended Abstracts of the 2021 CHI Conference on Human Factors in Computing Systems (CHI EA ‘21). Association for Computing Machinery, New York, NY, USA, Article 484, 1–6. https://doi.org/10.1145/3411763.3451515 <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/ddd" class="page__taxonomy-item p-category" rel="tag">ddd</a><span class="sep">, </span>
    
      <a href="/tags/dsl" class="page__taxonomy-item p-category" rel="tag">dsl</a><span class="sep">, </span>
    
      <a href="/tags/net" class="page__taxonomy-item p-category" rel="tag">net</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-10-01T00:00:00+00:00">October 1, 2022</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Experiment+06%20https%3A%2F%2Fdlfelps.github.io%2F2022%2F10%2F01%2FDSL1.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdlfelps.github.io%2F2022%2F10%2F01%2FDSL1.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://dlfelps.github.io/2022/10/01/DSL1.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2022/09/01/List-vs-Seq.html" class="pagination--pager" title="Experiment 05
">Previous</a>
    
    
      <a href="/2022/10/02/DSL2.html" class="pagination--pager" title="Experiment 07
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 <a href="https://dlfelps.github.io">.NET Experiments</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>









  </body>
</html>
