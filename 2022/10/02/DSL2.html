<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Experiment 07 - .NET Experiments</title>
<meta name="description" content="The second post in the domain specific language series demonstrates how you can use F# computation expressions to create an embedded language.">


  <meta name="author" content="Daniel Felps">
  
  <meta property="article:author" content="Daniel Felps">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content=".NET Experiments">
<meta property="og:title" content="Experiment 07">
<meta property="og:url" content="https://dlfelps.github.io/2022/10/02/DSL2.html">


  <meta property="og:description" content="The second post in the domain specific language series demonstrates how you can use F# computation expressions to create an embedded language.">







  <meta property="article:published_time" content="2022-10-02T00:00:00+00:00">






<link rel="canonical" href="https://dlfelps.github.io/2022/10/02/DSL2.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Daniel Felps",
      "url": "https://dlfelps.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title=".NET Experiments Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          .NET Experiments
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Experiment 07">
    <meta itemprop="description" content="The second post in the domain specific language series demonstrates how you can use F# computation expressions to create an embedded language.">
    <meta itemprop="datePublished" content="2022-10-02T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Experiment 07
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-10-02T00:00:00+00:00">October 2, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          14 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction">Introduction</a></li><li><a href="#data-model-2a-concise-record-syntax">Data model #2a (Concise record syntax)</a></li><li><a href="#data-model-2b-concise-record-syntax-with-placeholders">Data model #2b (Concise record syntax with placeholders)</a></li><li><a href="#data-model-2c-fluent-record-syntax">Data model #2c (Fluent record syntax)</a></li><li><a href="#some-other-examplesreferences">Some other examples/references</a></li><li><a href="#next">Next</a><ul><li><a href="#footnotes">Footnotes</a></li></ul></li></ul></li></ul>

            </nav>
          </aside>
        
        <p>The second post in the <strong>domain specific language</strong> series demonstrates how you can use F# computation expressions to create an embedded language.</p>

<h2 id="introduction">Introduction</h2>

<p><em>Please read the <a href="/2022/10/01/DSL1.html">first post</a> in this series before continuing.</em></p>

<p>This post demonstrates how to create a custom <a href="https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/computation-expressions">computation expression</a> to capture data. You may have already used computation expressions without knowing it -  <code class="language-plaintext highlighter-rouge">seq {}</code> and <code class="language-plaintext highlighter-rouge">async {}</code> are both built using computation expressions. Computation expressions  provide users with a way to extend F#. This ability is most similar to macros or metaprogramming abilities of other languages (e.g. LISP, Rust, Ruby, Template Haskell), but I find computation expressions more straightforward to understand and use. In this post, we will see how to create three kinds of computation expressions to model our data.</p>

<p>Before we learn how to create a custom computation expression, it is best to understand <em>why</em> we would want to do so. Our first example uses computation expressions to create a concise record syntax.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">trades</span> <span class="p">=</span> 
  <span class="n">trade</span><span class="p">{</span>
    <span class="nc">Buy</span> <span class="mi">4</span> <span class="nc">MSFT</span> <span class="mi">258</span><span class="p">.</span><span class="mi">32</span> <span class="nc">AllOrNone</span>
    <span class="nc">Sell</span> <span class="mi">3</span> <span class="nc">META</span> <span class="mi">158</span><span class="p">.</span><span class="mi">71</span> <span class="nc">AllOrNone</span>
    <span class="nc">Sell</span> <span class="mi">6</span> <span class="nc">GOOGL</span> <span class="mi">106</span><span class="p">.</span><span class="mi">08</span> <span class="nc">AllOrNone</span>
  <span class="p">}</span></code></pre></figure>

<h2 id="data-model-2a-concise-record-syntax">Data model #2a (Concise record syntax)</h2>

<p>The expression above creates the same list of <code class="language-plaintext highlighter-rouge">Trade</code> records as in the first post without having to specify the record’s field names. This is accomlished through the use of a  <a href="https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/computation-expressions#extending-existing-builders-with-new-custom-operations">custom computation expression</a>. First we define a <code class="language-plaintext highlighter-rouge">TradeBuilder</code> class and provide an implementation for <code class="language-plaintext highlighter-rouge">Yield</code><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>. Next we implement two custom operations (tagged with the <a href="https://fsharp.github.io/fsharp-core-docs/reference/fsharp-core-customoperationattribute.html"><code class="language-plaintext highlighter-rouge">CustomOperation</code></a> attribute). Due to the domain and record layout, I decided it was natural to use <code class="language-plaintext highlighter-rouge">Buy</code> and <code class="language-plaintext highlighter-rouge">Sell</code> as keywords to create the record. Each method takes 5 parameters: the first argument captures trades that were created above the current trade but within the same computation expression; it has type <code class="language-plaintext highlighter-rouge">seq&lt;Trade&gt;</code>. The next 4 parameters match those of the record (except <code class="language-plaintext highlighter-rouge">price</code>, which takes a <code class="language-plaintext highlighter-rouge">float</code> and is converted to <code class="language-plaintext highlighter-rouge">decimal</code>).</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">module</span> <span class="nc">Trade</span> <span class="p">=</span> 

  <span class="k">type</span> <span class="nc">TradeBuilder</span><span class="bp">()</span> <span class="p">=</span>

      <span class="k">member</span> <span class="o">_.</span><span class="nc">Yield</span> <span class="p">_</span> <span class="p">=</span> <span class="bp">[]</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Buy"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Buy</span> <span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">seq</span><span class="p">&lt;</span><span class="nc">Trade</span><span class="o">&gt;,</span> <span class="n">numShares</span><span class="p">:</span><span class="kt">int</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span><span class="nc">Stocks</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span><span class="kt">float</span><span class="p">,</span> <span class="n">allOrNone</span><span class="p">:</span><span class="nc">Portion</span><span class="p">)</span> <span class="p">=</span> 
        <span class="p">[</span><span class="k">yield</span><span class="o">!</span> <span class="n">previous</span>
         <span class="k">yield</span> <span class="p">{</span><span class="n">buyOrSell</span><span class="p">=</span><span class="nc">Buy</span><span class="p">;</span> <span class="n">ticker</span><span class="p">=</span><span class="n">ticker</span><span class="p">;</span><span class="n">numShares</span><span class="p">=</span><span class="n">numShares</span><span class="p">;</span><span class="n">price</span><span class="p">=</span><span class="n">decimal</span><span class="p">(</span><span class="n">price</span><span class="o">);</span><span class="n">allOrNone</span><span class="o">=(</span><span class="n">allOrNone</span><span class="p">=</span><span class="nc">AllOrNone</span><span class="o">)}]</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Sell"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Sell</span> <span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">seq</span><span class="p">&lt;</span><span class="nc">Trade</span><span class="o">&gt;,</span> <span class="n">numShares</span><span class="p">:</span><span class="kt">int</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span><span class="nc">Stocks</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span><span class="kt">float</span><span class="p">,</span> <span class="n">allOrNone</span><span class="p">:</span><span class="nc">Portion</span><span class="p">)</span> <span class="p">=</span> 
        <span class="p">[</span><span class="k">yield</span><span class="o">!</span> <span class="n">previous</span>
         <span class="k">yield</span> <span class="p">{</span><span class="n">buyOrSell</span><span class="p">=</span><span class="nc">Sell</span><span class="p">;</span> <span class="n">ticker</span><span class="p">=</span><span class="n">ticker</span><span class="p">;</span><span class="n">numShares</span><span class="p">=</span><span class="n">numShares</span><span class="p">;</span><span class="n">price</span><span class="p">=</span><span class="n">decimal</span><span class="p">(</span><span class="n">price</span><span class="o">);</span><span class="n">allOrNone</span><span class="o">=(</span><span class="n">allOrNone</span><span class="p">=</span><span class="nc">AllOrNone</span><span class="o">)}]</span></code></pre></figure>

<p>Before we can use the computation expression, we must initialize it with:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">trade</span> <span class="p">=</span> <span class="nn">Trade</span><span class="p">.</span><span class="nc">TradeBuilder</span><span class="bp">()</span>

<span class="k">let</span> <span class="n">trades</span> <span class="p">=</span> 
  <span class="n">trade</span><span class="p">{</span>
    <span class="nc">Buy</span> <span class="mi">4</span> <span class="nc">MSFT</span> <span class="mi">258</span><span class="p">.</span><span class="mi">32</span> <span class="nc">AllOrNone</span>
    <span class="nc">Sell</span> <span class="mi">3</span> <span class="nc">META</span> <span class="mi">158</span><span class="p">.</span><span class="mi">71</span> <span class="nc">AllOrNone</span>
    <span class="nc">Sell</span> <span class="mi">6</span> <span class="nc">GOOGL</span> <span class="mi">106</span><span class="p">.</span><span class="mi">08</span> <span class="nc">AllOrNone</span>
  <span class="p">}</span></code></pre></figure>

<p>Then if we run <code class="language-plaintext highlighter-rouge">Trade.trademany trades</code> we get the correct output:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">You just purchased 4 shares of MSFT for a total cost of $</span>1,033.28.
<span class="gp">You just sold 3 shares of META for a total earnings of $</span>476.13.
<span class="gp">You just sold 6 shares of GOOGL for a total earnings of $</span>636.48.
<span class="go">-------------------------------------------------------------------
</span><span class="gp">You just executed a series of trades that earned you $</span>79.33.</code></pre></figure>

<h2 id="data-model-2b-concise-record-syntax-with-placeholders">Data model #2b (Concise record syntax with placeholders)</h2>

<p>The approach above has a serious flaw - without specifying the field names it could be very easy to forget to include a field or put it in the wrong order. Imagine a record with 5 fields all of the same type (e.g. decimal), how would you keep them straight? In some domains it may be appropriate to add a few placeholder keywords to help keep things straight. In this example, the following probably reads much better to domain experts:</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">trades</span> <span class="p">=</span> 
  <span class="n">trade</span><span class="p">{</span>
    <span class="nc">Buy</span> <span class="mi">4</span> <span class="nc">SharesOf</span> <span class="nc">MSFT</span> <span class="nc">At</span> <span class="mi">258</span><span class="p">.</span><span class="mi">32</span> <span class="nc">AllOrNone</span>
    <span class="nc">Sell</span> <span class="mi">3</span> <span class="nc">SharesOf</span> <span class="nc">META</span> <span class="nc">At</span> <span class="mi">158</span><span class="p">.</span><span class="mi">71</span> <span class="nc">AllOrNone</span>
    <span class="nc">Sell</span> <span class="mi">6</span> <span class="nc">SharesOf</span> <span class="nc">GOOGL</span> <span class="nc">At</span> <span class="mi">106</span><span class="p">.</span><span class="mi">08</span> <span class="nc">AllOrNone</span>
  <span class="p">}</span></code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">SharesOf</code> keyword tells you 2 things - the previous parameter was the number of shares and the following parameter is company. The <code class="language-plaintext highlighter-rouge">At</code> keyword separates the price constraints for the trade. This is still much more concise than specifying all the field names and it improves readability, but it may not be possible in all cases. To update  the <code class="language-plaintext highlighter-rouge">TradeBuilder</code> code we need to define two new types (<code class="language-plaintext highlighter-rouge">SharesOf</code> and <code class="language-plaintext highlighter-rouge">At</code>) and add them to the parameter list of each method.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">type</span> <span class="nc">SharesOf</span> <span class="p">=</span> <span class="nc">SharesOf</span>
<span class="k">type</span> <span class="nc">At</span> <span class="p">=</span> <span class="nc">At</span>

<span class="k">module</span> <span class="nc">Trade</span> <span class="p">=</span> 

  <span class="k">type</span> <span class="nc">TradeBuilder</span><span class="bp">()</span> <span class="p">=</span>

      <span class="k">member</span> <span class="o">_.</span><span class="nc">Yield</span> <span class="p">_</span> <span class="p">=</span> <span class="bp">[]</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Buy"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Buy</span> <span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">seq</span><span class="p">&lt;</span><span class="nc">Trade</span><span class="o">&gt;,</span> <span class="n">numShares</span><span class="p">:</span><span class="kt">int</span><span class="p">,</span> <span class="n">sharesOf</span><span class="p">:</span><span class="nc">SharesOf</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span><span class="nc">Stocks</span><span class="p">,</span> <span class="n">at</span><span class="p">:</span><span class="nc">At</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span><span class="kt">float</span><span class="p">,</span> <span class="n">allOrNone</span><span class="p">:</span><span class="nc">Portion</span><span class="p">)</span> <span class="p">=</span> 
        <span class="p">[</span><span class="k">yield</span><span class="o">!</span> <span class="n">previous</span>
         <span class="k">yield</span> <span class="p">{</span><span class="n">buyOrSell</span><span class="p">=</span><span class="nc">Buy</span><span class="p">;</span> <span class="n">ticker</span><span class="p">=</span><span class="n">ticker</span><span class="p">;</span><span class="n">numShares</span><span class="p">=</span><span class="n">numShares</span><span class="p">;</span><span class="n">price</span><span class="p">=</span><span class="n">decimal</span><span class="p">(</span><span class="n">price</span><span class="o">);</span><span class="n">allOrNone</span><span class="o">=(</span><span class="n">allOrNone</span><span class="p">=</span><span class="nc">AllOrNone</span><span class="o">)}]</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Sell"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Sell</span> <span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">seq</span><span class="p">&lt;</span><span class="nc">Trade</span><span class="o">&gt;,</span> <span class="n">numShares</span><span class="p">:</span><span class="kt">int</span><span class="p">,</span> <span class="n">sharesOf</span><span class="p">:</span><span class="nc">SharesOf</span><span class="p">,</span> <span class="n">ticker</span><span class="p">:</span><span class="nc">Stocks</span><span class="p">,</span> <span class="n">at</span><span class="p">:</span><span class="nc">At</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span><span class="kt">float</span><span class="p">,</span> <span class="n">allOrNone</span><span class="p">:</span><span class="nc">Portion</span><span class="p">)</span> <span class="p">=</span> 
        <span class="p">[</span><span class="k">yield</span><span class="o">!</span> <span class="n">previous</span>
         <span class="k">yield</span> <span class="p">{</span><span class="n">buyOrSell</span><span class="p">=</span><span class="nc">Sell</span><span class="p">;</span> <span class="n">ticker</span><span class="p">=</span><span class="n">ticker</span><span class="p">;</span><span class="n">numShares</span><span class="p">=</span><span class="n">numShares</span><span class="p">;</span><span class="n">price</span><span class="p">=</span><span class="n">decimal</span><span class="p">(</span><span class="n">price</span><span class="o">);</span><span class="n">allOrNone</span><span class="o">=(</span><span class="n">allOrNone</span><span class="p">=</span><span class="nc">AllOrNone</span><span class="o">)}]</span>
        </code></pre></figure>

<h2 id="data-model-2c-fluent-record-syntax">Data model #2c (Fluent record syntax)</h2>

<p>The final computation expression uses the <a href="https://refactoring.guru/design-patterns/builder">Builder Design Pattern</a> and a Fluent expression style to create trades. This approach is most useful when you can set default values for everything and then specify a subset of fields to update (similar to the <code class="language-plaintext highlighter-rouge">{default with ...}</code> record syntax). It also provides a way to set fields in any order. But unlike the previous two computation expressions, this approach only creates a single trade per expression.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">let</span> <span class="n">trades</span> <span class="p">=</span> 
  <span class="p">[</span>
    <span class="n">trade</span> <span class="p">{</span>
      <span class="nc">Buy</span> <span class="mi">4</span>
      <span class="nc">SharesOf</span> <span class="nc">MSFT</span>
      <span class="nc">At</span> <span class="mi">258</span><span class="p">.</span><span class="mi">32</span>
      <span class="nc">AllOrNone</span>
    <span class="o">};</span>
    <span class="c1">//AllOrNone optional</span>
    <span class="n">trade</span> <span class="p">{</span>
      <span class="nc">Sell</span> <span class="mi">3</span>
      <span class="nc">SharesOf</span> <span class="nc">META</span>
      <span class="nc">At</span> <span class="mi">158</span><span class="p">.</span><span class="mi">71</span>      
    <span class="o">};</span>
    <span class="c1">// order-independent</span>
    <span class="n">trade</span> <span class="p">{</span>
      <span class="nc">AllOrNone</span>
      <span class="nc">At</span> <span class="mi">106</span><span class="p">.</span><span class="mi">08</span>      
      <span class="nc">SharesOf</span> <span class="nc">GOOGL</span>
      <span class="nc">Sell</span> <span class="mi">6</span>
    <span class="o">};</span>
  <span class="p">]</span>
        </code></pre></figure>

<p>As you might have guessed, the <code class="language-plaintext highlighter-rouge">TradeBuilder</code> code is significanly different. <code class="language-plaintext highlighter-rouge">Yield</code> now provides the default record and we must specify custom operations for <code class="language-plaintext highlighter-rouge">Buy</code>, <code class="language-plaintext highlighter-rouge">Sell</code>, <code class="language-plaintext highlighter-rouge">SharesOf</code>, <code class="language-plaintext highlighter-rouge">At</code>, <code class="language-plaintext highlighter-rouge">AllOrNone</code>, and <code class="language-plaintext highlighter-rouge">Partial</code>. Each method takes the current trade and updates the corresponding field.</p>

<figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">module</span> <span class="nc">Trade</span> <span class="p">=</span> 

  <span class="k">let</span> <span class="n">baseTrade</span> <span class="p">=</span> <span class="p">{</span><span class="n">buyOrSell</span> <span class="p">=</span> <span class="nc">Buy</span><span class="p">;</span> <span class="n">ticker</span><span class="p">=</span><span class="nc">MSFT</span><span class="p">;</span> <span class="n">numShares</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">price</span><span class="p">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">m</span><span class="p">;</span> <span class="n">allOrNone</span><span class="p">=</span><span class="bp">true</span><span class="p">}</span>

  <span class="k">type</span> <span class="nc">TradeBuilder</span><span class="bp">()</span> <span class="p">=</span>

      <span class="k">member</span> <span class="o">_.</span><span class="nc">Yield</span> <span class="p">_</span> <span class="p">=</span> <span class="n">baseTrade</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Buy"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Buy</span> <span class="p">(</span><span class="n">trade</span><span class="p">:</span> <span class="nc">Trade</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span><span class="n">trade</span> <span class="k">with</span> <span class="n">numShares</span> <span class="p">=</span> <span class="n">input</span><span class="p">;</span> <span class="n">buyOrSell</span> <span class="p">=</span> <span class="nc">Buy</span><span class="p">}</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Sell"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Sell</span> <span class="p">(</span><span class="n">trade</span><span class="p">:</span> <span class="nc">Trade</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span><span class="n">trade</span> <span class="k">with</span> <span class="n">numShares</span> <span class="p">=</span> <span class="n">input</span><span class="p">;</span> <span class="n">buyOrSell</span> <span class="p">=</span> <span class="nc">Sell</span><span class="p">}</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"SharesOf"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Ticker</span> <span class="p">(</span><span class="n">trade</span><span class="p">:</span> <span class="nc">Trade</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="nc">Stocks</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span><span class="n">trade</span> <span class="k">with</span> <span class="n">ticker</span> <span class="p">=</span> <span class="n">input</span><span class="p">}</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"At"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Price</span> <span class="p">(</span><span class="n">trade</span><span class="p">:</span> <span class="nc">Trade</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="kt">float</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span><span class="n">trade</span> <span class="k">with</span> <span class="n">price</span> <span class="p">=</span> <span class="n">decimal</span><span class="p">(</span><span class="n">input</span><span class="o">)}</span>

      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"AllOrNone"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">AllOrNone</span> <span class="p">(</span><span class="n">trade</span><span class="p">:</span> <span class="nc">Trade</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span><span class="n">trade</span> <span class="k">with</span> <span class="n">allOrNone</span> <span class="p">=</span> <span class="bp">true</span><span class="p">}</span>
    
      <span class="p">[&lt;</span><span class="nc">CustomOperation</span><span class="p">(</span><span class="s2">"Partial"</span><span class="o">)&gt;]</span>
      <span class="k">member</span> <span class="o">_.</span><span class="nc">Partial</span> <span class="p">(</span><span class="n">trade</span><span class="p">:</span> <span class="nc">Trade</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span><span class="n">trade</span> <span class="k">with</span> <span class="n">allOrNone</span> <span class="p">=</span> <span class="bp">false</span><span class="p">}</span>
        </code></pre></figure>

<h2 id="some-other-examplesreferences">Some other examples/references</h2>

<p>In my opinion, custom computational expressions are an underused feature of F#. They are much more flexible/powerful than we are showing here so if you would like learn more please check out the following resources that use custom computation expressions.</p>

<p><a href="https://github.com/panesofglass/computation-expressions-workshop">Computation expressions workshop</a></p>

<p><a href="https://www.youtube.com/watch?v=pC4ZIeOmgB0&amp;t=2461s">Computation Expressions Explained - Youtube</a></p>

<p><a href="https://atlemann.github.io/fsharp/2019/12/11/mindstorms-dsl.html">Lego Mindstorms DSL</a></p>

<p><a href="https://github.com/fsprojects/FsHttp/blob/master/src/FsHttp/Dsl.CE.fs">FsHttp CE</a></p>

<h2 id="next">Next</h2>

<p>In the final post of this series we will learn about the difference between an internal and external domain specific language and use <a href="https://github.com/stephan-tolksdorf/fparsec">FParsec</a> to load records after compile time!</p>

<h4 id="footnotes">Footnotes</h4>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/computation-expressions#creating-a-new-type-of-computation-expression <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/ddd" class="page__taxonomy-item" rel="tag">ddd</a><span class="sep">, </span>
    
      <a href="/tags/dsl" class="page__taxonomy-item" rel="tag">dsl</a><span class="sep">, </span>
    
      <a href="/tags/net" class="page__taxonomy-item" rel="tag">net</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-10-02T00:00:00+00:00">October 2, 2022</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Experiment+07%20https%3A%2F%2Fdlfelps.github.io%2F2022%2F10%2F02%2FDSL2.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdlfelps.github.io%2F2022%2F10%2F02%2FDSL2.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdlfelps.github.io%2F2022%2F10%2F02%2FDSL2.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2022/10/01/DSL1.html" class="pagination--pager" title="Experiment 06
">Previous</a>
    
    
      <a href="/2022/10/03/DSL3.html" class="pagination--pager" title="Experiment 08
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Daniel Felps. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
